# Configuration

[Up to Index](index.html)

 - [Important parameters](#important-parameters)
 - [The configuration file](#the-configuration-file)
 - [Logging](logging.html)
 - [Loadable modules](#loadable-modules)

## Important parameters

XXX

 - port, interface
 - data dir
 - config file path

## The configuration file

XXX where is it by default

Each option that can be specified on the command line can also be
specified in a configuration file. To see available options, use
`--help` on the command line:

    $ ./qpidd --help

The configuration file uses name/value pairs, one on each line. To
convert a command line option to a configuration file entry:

1. Remove the '`--`' from the beginning of the option.

2. Place an '`=`' between the option and the value.  Use `yes` or
   `true` to enable options that take no value when specified on the
   command line.

3. Place one option per line.

For instance, the `--daemon` option takes no value, and the
`--log-to-syslog` option takes the values `yes` or `no`. The following
configuration file sets these two options:

    daemon=yes
    log-to-syslog=yes

## Loadable modules

By default the broker will load all the modules in the module
directory. However, it will *not* display options for modules located
outside the module directory unless they are explicitly loaded. To see
the options for extra modules loaded you need to load the module and
then add the help command, as in the following example:

    ./qpidd --load-module libbdbstore.so --help
    Usage: qpidd OPTIONS
    Options:
      -h [ --help ]                    Displays the help message
      -v [ --version ]                 Displays version information
      --config FILE (/etc/qpidd.conf)  Reads configuration from FILE

    ## Non-module options would be here ##

    Store Options:
      --store-directory DIR     Store directory location for persistence (overrides
                                --data-dir)
      --store-async yes|no (1)  Use async persistence storage - if store supports
                                it, enables AIO O_DIRECT.
      --store-force yes|no (0)  Force changing modes of store, will delete all
                                existing data if mode is changed. Be SURE you want
                                to do this!
      --num-jfiles N (8)        Number of files in persistence journal
      --jfile-size-pgs N (24)   Size of each journal file in multiples of read
                                pages (1 read page = 64kiB)

## Unfiled

### Slightly more complex configuration [XXX]

For a full list of the broker's options, run `qpidd --help` from the
command line:

    ./qpidd --help

    Usage: qpidd OPTIONS
    Options:
      -h [ --help ]                    Displays the help message
      -v [ --version ]                 Displays version information
      --config FILE (/etc/qpidd.conf)  Reads configuration from FILE

    Module options:
      --module-dir DIR (/usr/lib/qpidd)  Load all .so modules in this directory
      --load-module FILE                 Specifies additional module(s) to be loaded
      --no-module-dir                    Don't load modules from module directory

    Broker Options:
      --data-dir DIR (/var/lib/qpidd)   Directory to contain persistent data generated by the broker
      --no-data-dir                     Don't use a data directory.  No persistent
                                        configuration will be loaded or stored
      -p [ --port ] PORT (5672)         Tells the broker to listen on PORT
      --worker-threads N (3)            Sets the broker thread pool size
      --max-connections N (500)         Sets the maximum allowed connections
      --connection-backlog N (10)       Sets the connection backlog limit for the
                                        server socket
      --staging-threshold N (5000000)   Stages messages over N bytes to disk
      -m [ --mgmt-enable ] yes|no (1)   Enable Management
      --mgmt-pub-interval SECONDS (10)  Management Publish Interval
      --ack N (0)                       Send session.ack/solicit-ack at least every
                                        N frames. 0 disables voluntary ack/solitict
                                       -ack

    Daemon options:
      -d [ --daemon ]             Run as a daemon.
      -w [ --wait ] SECONDS (10)  Sets the maximum wait time to initialize the
                                  daemon. If the daemon fails to initialize, prints
                                  an error and returns 1
      -c [ --check ]              Prints the daemon's process ID to stdout and
                                  returns 0 if the daemon is running, otherwise
                                  returns 1
      -q [ --quit ]               Tells the daemon to shut down
    Logging options:
      -t [ --trace ]              Enables all logging
      --log-enable RULE (notice+) Enables logging for selected levels and components. 
                                  RULE is in the form 'LEVEL[+-][:PATTERN]'
                                  LEVEL is one of: 
                                     trace debug info notice warning error critical
                                  PATTERN is a logging category name, or a namespace-qualified 
                                  function name or name fragment. 
                                     Logging category names are: 
                                     Security Broker Management Protocol System HA Messaging Store 
                                     Network Test Client Model Unspecified

                                  For example:
                                      '--log-enable warning+'
                                      logs all warning, error and critical messages.

                                      '--log-enable trace+:Broker'
                                      logs all category 'Broker' messages.

                                      '--log-enable debug:framing'
                                      logs debug messages from all functions with 'framing' in 
                                      the namespace or function name.

                                  This option can be used multiple times

      --log-disable RULE          Disables logging for selected levels and components. 
                                  RULE is in the form 'LEVEL[+-][:PATTERN]'
                                  LEVEL is one of: 
                                     trace debug info notice warning error critical
                                  PATTERN is a logging category name, or a namespace-qualified 
                                  function name or name fragment. 
                                     Logging category names are: 
                                     Security Broker Management Protocol System HA Messaging Store 
                                     Network Test Client Model Unspecified

                                  For example:
                                      '--log-disable warning-'
                                      disables logging all warning, notice, info, debug, and 
                                      trace messages.

                                      '--log-disable trace:Broker'
                                      disables all category 'Broker' trace messages.

                                      '--log-disable debug-:qmf::'
                                      disables logging debug and trace messages from all functions 
                                      with 'qmf::' in the namespace.

                                  This option can be used multiple times

      --log-time yes|no (1)                 Include time in log messages
      --log-level yes|no (1)                Include severity level in log messages
      --log-source yes|no (0)               Include source file:line in log 
                                            messages
      --log-thread yes|no (0)               Include thread ID in log messages
      --log-function yes|no (0)             Include function signature in log 
                                            messages
      --log-hires-timestamp yes|no (0)      Use hi-resolution timestamps in log 
                                            messages
      --log-category yes|no (1)             Include category in log messages
      --log-prefix STRING                   Prefix to prepend to all log messages

    Logging sink options:
      --log-to-stderr yes|no (1)            Send logging output to stderr
      --log-to-stdout yes|no (0)            Send logging output to stdout
      --log-to-file FILE                    Send log output to FILE.
      --log-to-syslog yes|no (0)            Send logging output to syslog;
                                            customize using --syslog-name and 
                                            --syslog-facility
      --syslog-name NAME (qpidd)            Name to use in syslog messages
      --syslog-facility LOG_XXX (LOG_DAEMON) 
                                            Facility to use in syslog messages

## Timestamping received messages

The AMQP 0-10 specification defines a *timestamp* message delivery
property. The timestamp delivery property is a *datetime* value that is
written to each message that arrives at the broker. See the description
of "message.delivery-properties" in the "Command Classes" section of the
AMQP 0-10 specification for more detail.

See the *Programming in Apache Qpid* documentation for information
regarding how clients may access the timestamp value in received
messages.

By default, this timestamping feature is disabled. To enable
timestamping, use the *enable-timestamp* broker configuration option.
Setting the enable-timestamp option to 'yes' will enable message
timestamping:

    ./qpidd --enable-timestamp yes
      

Message timestamping can also be enabled (and disabled) without
restarting the broker. The QMF Broker management object defines two
methods for accessing the timestamp configuration:

  Method               Description
  -------------------- -------------------------------------------------------------------------------------------------------------------------------
  getTimestampConfig   Get the message timestamping configuration. Returns True if received messages are timestamped.
  setTimestampConfig   Set the message timestamping configuration. Set True to enable timestamping received messages, False to disable timestamping.

  : QMF Management - Broker Methods for Managing the Timestamp
  Configuration

The following code fragment uses these QMF method calls to enable
message timestamping.

    # get the state of the timestamp configuration
    broker = self.qmf.getObjects(_class="broker")[0]
    rc = broker.getTimestampConfig()
    self.assertEqual(rc.status, 0)
    self.assertEqual(rc.text, "OK")
    print("The timestamp setting is %s" % str(rc.receive))

    # try to enable it
    rc = broker.setTimestampConfig(True)
    self.assertEqual(rc.status, 0)
    self.assertEqual(rc.text, "OK")

